FROM ruby:2.4-alpine3.6
RUN apk add --update \
    build-base \
    postgresql-dev \
    nodejs \
    sqlite-dev \
    tzdata \
    imagemagick
RUN mkdir /spree
WORKDIR /spree
ADD . /spree
RUN gem install rails -v 5.1.4
RUN rails _5.1.4_ new mystore
WORKDIR /spree/mystore
RUN sh ../edit.sh
RUN bundle install
RUN rails g spree:install --user_class=Spree::User --auto-accept
RUN rails g spree:auth:install
EXPOSE 3000
ENTRYPOINT rails server